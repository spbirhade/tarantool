
#include <stdio.h>
#include <stdlib.h>

#include <libtnt.h>

int
main()
{
	tnt_t * t = tnt_alloc();
	if (t == NULL)
		return 1;

	tnt_set(t, TNT_OPT_HOSTNAME, "localhost");
	if (tnt_init(t) == -1)
		return 1;

	if (tnt_connect(t) == -1) {
		tnt_free(t);
		return 1;
	}

	{
		char message[]= {
			0xd, 0x0, 0x0, 0x0,    0x11, 0x0, 0x0, 0x0,    0x0, 0x0, 0x0, 0x0,
			0x0, 0x0, 0x0, 0x0,    0x0, 0x0, 0x0, 0x0,     0x1, 0x0, 0x0, 0x0,
			0x4,    0x1, 0x0, 0x0, 0x0 };

		int res = tnt_io_send_raw(t, message, sizeof(message));
		printf("return_code: %d\n", res); // =0
	}

	{
		/*
		 * A test case for Bug#702397
		 * https://bugs.launchpad.net/tarantool/+bug/702397
		 * "If SELECT request specifies tuple count 0, no error"
		 */
		char message[]= {
			0x11, 0x0, 0x0, 0x0,    0x14, 0x0, 0x0, 0x0,    0x0, 0x0, 0x0, 0x0,
			0x0, 0x0, 0x0, 0x0,     0x0, 0x0, 0x0, 0x0,     0x0, 0x0, 0x0, 0x0,
			0xff, 0xff, 0xff, 0xff, 0x0, 0x0, 0x0, 0x0 };

		int res = tnt_io_send_raw(t, message, sizeof(message));
		printf("return_code: %d\n", res); // =2
	}

	tnt_free(t);
	return 0;
}
